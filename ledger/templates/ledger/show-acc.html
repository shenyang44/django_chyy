{% extends 'ledger/layout.html' %}
{% block title %}{{account.file_no}}{% endblock %}

{% block body %}
<header class="fs-5 fw-bold text-center mb-3">
    <div>MESSRS C.H.YEOH & YIEW</div>
    <div>Transaction History</div>
</header>
<div class="container d-flex flex-wrap">
    <div class="d-flex flex-column fw-bold print-sm">
        <div>
            Client Code:
        </div>
        <div>
            Name:
        </div>
        <div >
            File Ref:
        </div>
        <div>
            Sub. Matter:
        </div>
    </div>
    <div style="width: 30%;"class="ms-3 d-flex flex-column print-sm">
        <div>
            {{account.client_code}}
        </div>
        <div>
            {{account.name}}
        </div>
        <div>
            {{account.file_no}}
        </div>
        <div>
            subject matter
        </div>
    </div>
    <div style="width: 30%;" class="fw-bold d-flex align-items-center print-sm">
        Your Ref:
    </div>
    <div class="d-flex flex-column fw-bold print-sm">
        <div>
            Client Ledger
        </div>
        <div>
            Report Date:
        </div>
        <div>
            Page:
        </div>
    </div>
    <div class="d-flex flex-column print-sm">
        <br>
        <div>
            {% now "d/m/Y" %}
        </div>
        <div>
            todo
        </div>
    </div>
    <div style="width: 100%;" class="d-flex print-sm">
        <div class="w-25">
            <span class="fw-bold">Date From: &nbsp;</span>todo 
        </div>
        <div class="w-25">
            <span class="fw-bold">Date To: &nbsp;</span>todo
        </div>
    </div>
</div>
<table class="table print-sm">
    <colgroup>
        <col style="width: 10%;">
        <col style="width:10%;">
        <col style="width: 5%;">
        <col style="width: 40%;">
        <col style="width:10%">
        <col style="width: 10%;">
        <col style="width: 15%;">
    </colgroup>
    <thead>
        <tr>
            <th scope="col">Ref No</th>
            <th scope="col">Date</th>
            <th scope="col">Type</th>
            <th scope="col">Description</th>
            <th class="text-center" scope="col">Debit</th>
            <th class="text-center" scope="col">Credit</th>
            <th class="text-center" scope="col">Balance</th>
        </tr>
    </thead>
    <tbody>
    {% for trans, entries, rb in trans_zipped %}
        {% for desc, amt in entries %}
            <tr class="transRow" data-id="{{trans.id}}">
                {% if account == trans.payee %}
                    <a href="{% url 'ledger:voucher' trans.id %}" id = a{{trans.id}} class="hidden-links"></a>
                    <td class="refCell">
                        PV{{trans.id|stringformat:"05d"}}
                    </td>
                {% else %}
                    <a href="{% url 'ledger:receipt' trans.id %}" id = a{{trans.id}} class="hidden-links"></a>
                    <td class="refCell">
                        RC{{trans.id|stringformat:"05d"}}
                    </td>
                {% endif %}
                <td>{{trans.created_at|date:"d/m/Y"}}</td>
                <td>{{trans.type_code}}</td>
                <td>
                    <div class="d-flex justify-content-between">
                        {{desc}}
                    </div>
                </td>
                <td class="text-center">{% if trans.payee.file_no == account.file_no %}{{amt}} {% endif %}</td>
                <td class="text-center">{% if trans.receiver.file_no == account.file_no %}{{amt}}{% endif %}</td>
                <td class="text-center">{% if forloop.last %}{{rb}}{% endif %}</td>
            </tr>
        {% endfor %}
    {% endfor %}
    </tbody>
</table>
<div class='mt-3 print-n btn-cluster'>
    <button id='printBtn' class="btn btn-secondary" type="button" onclick="window.print()">Print</button>
    <a class="btn btn-outline-primary" href="{% url 'ledger:create_trans' account.id %}">New Transaction</a>
</div>

<script charset="utf-8">
    $(()=>{
        $('.transRow').dblclick((e)=>{
            id = $(e.currentTarget).attr('data-id');
            $(`#a${id}`)[0].click()
        })
    })
</script>
{% endblock %}